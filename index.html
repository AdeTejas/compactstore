<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Compact Store</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Lora:wght@700&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Roboto', sans-serif; background: #ffffff; color: #1a1a1a; transition: all 0.3s; }
    body.dark { background: #1a1a1a; color: #ffffff; }
    header { background: #ffffff; border-bottom: 1px solid #e0e0e0; padding: 1rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 10; }
    body.dark header { background: #2a2a2a; border-bottom: 1px solid #444; }
    header h1 { font-family: 'Lora', serif; font-size: 2rem; color: #c0c0c0; }
    .cart-icon, .wishlist-icon { cursor: pointer; font-size: 1.5rem; position: relative; margin-left: 1rem; }
    .cart-count, .wishlist-count { position: absolute; top: -10px; right: -10px; background: #c0c0c0; color: #1a1a1a; border-radius: 50%; padding: 0.2rem 0.5rem; font-size: 0.8rem; }
    .theme-toggle { cursor: pointer; font-size: 1.2rem; }
    .hamburger { display: none; cursor: pointer; font-size: 1.5rem; }
    .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    .carousel { overflow: hidden; position: relative; margin-bottom: 1rem; }
    .carousel-track { display: flex; transition: transform 0.5s ease; }
    .carousel-item { flex: 0 0 33.33%; padding: 0.5rem; }
    .carousel-item img { width: 100%; height: 150px; object-fit: cover; }
    .carousel-nav { position: absolute; top: 50%; transform: translateY(-50%); font-size: 1.5rem; cursor: pointer; background: rgba(0,0,0,0.5); color: #fff; padding: 0.5rem 1rem; border: none; border-radius: 0.25rem; }
    .carousel-nav.prev { left: 0; }
    .carousel-nav.next { right: 0; }
    .controls { display: flex; gap: 1rem; margin: 1rem 0; flex-wrap: wrap; }
    .search, .filter, .sort { flex: 1; min-width: 200px; }
    .search input, .filter select, .sort select { width: 100%; padding: 0.5rem; border: 1px solid #e0e0e0; border-radius: 0.25rem; font-size: 1rem; }
    body.dark .search input, body.dark .filter select, body.dark .sort select { background: #2a2a2a; color: #ffffff; border-color: #444; }
    .filter label, .sort label { font-size: 1rem; display: block; margin-bottom: 0.5rem; }
    .filter input[type="range"] { accent-color: #c0c0c0; }
    .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1rem; animation: fadeIn 0.5s; }
    .product-card { background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 0.5rem; padding: 1rem; text-align: center; transition: transform 0.3s, box-shadow 0.3s; opacity: 0; animation: fadeIn 0.5s forwards; }
    body.dark .product-grid { color: #ffffff; }
    body.dark .product-card { background: #2a2a2a; border-color: #444; }
    .product-card:nth-child(1) { animation-delay: 0.1s; }
    .product-card:nth-child(2) { animation-delay: 0.2s; }
    .product-card:nth-child(3) { animation-delay: 0.3s; }
    .product-card:nth-child(4) { animation-delay: 0.4s; }
    .product-card:hover { transform: translateY(-5px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    body.dark .product-card:hover { box-shadow: 0 4px 15px rgba(255,255,255,0.1); }
    .product-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 0.25rem; }
    .product-card h3 { font-family: 'Lora', serif; margin: 0.5rem 0; font-size: 1.2rem; }
    .product-card p { color: #666; margin: 0.5rem 0; }
    body.dark .product-card p { color: #b0b0b0; }
    .product-desc { font-size: 0.9rem; color: #666; }
    body.dark .product-desc { color: #b0b0b0; }
    .product-card button, .wishlist-btn { background: #1a1a1a; color: #ffffff; border: none; padding: 0.5rem 1rem; border-radius: 0.25rem; cursor: pointer; transition: all 0.3s; margin: 0.2rem; }
    body.dark .product-card button, body.dark .wishlist-btn { background: #c0c0c0; color: #1a1a1a; }
    .product-card button:hover, .wishlist-btn:hover { background: #c0c0c0; color: #1a1a1a; transform: scale(1.05); }
    body.dark .product-card button:hover, body.dark .wishlist-btn:hover { background: #a0a0a0; }
    .cart-sidebar { position: fixed; top: 0; right: 0; height: 100%; width: 300px; background: #f5f5f5; box-shadow: -2px 0 10px rgba(0,0,0,0.2); padding: 1rem; transform: translateX(100%); transition: transform 0.5s ease-out; }
    body.dark .cart-sidebar { background: #2a2a2a; }
    .cart-sidebar.open { transform: translateX(0); animation: bounceIn 0.5s; }
    @keyframes bounceIn { 0% { transform: translateX(100%); } 60% { transform: translateX(-10px); } 100% { transform: translateX(0); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .cart-sidebar h2 { font-family: 'Lora', serif; margin: 0 0 1rem; font-size: 1.5rem; }
    .cart-item { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
    .cart-item button { color: #c0c0c0; background: none; border: none; cursor: pointer; }
    .cart-total { font-weight: bold; margin: 1rem 0; }
    .checkout-btn { background: #1a1a1a; color: #ffffff; border: none; padding: 0.5rem; width: 100%; border-radius: 0.25rem; cursor: pointer; transition: all 0.3s; }
    body.dark .checkout-btn { background: #c0c0c0; color: #1a1a1a; }
    .checkout-btn:hover { background: #c0c0c0; color: #1a1a1a; transform: scale(1.05); }
    body.dark .checkout-btn:hover { background: #a0a0a0; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 100; }
    .modal-content { background: #f5f5f5; padding: 2rem; border-radius: 0.5rem; text-align: center; max-width: 500px; width: 90%; border: 1px solid #c0c0c0; animation: fadeIn 0.3s; }
    body.dark .modal-content { background: #2a2a2a; }
    .modal-content img { width: 100%; height: 300px; object-fit: cover; border-radius: 0.25rem; }
    .modal-content h3 { font-family: 'Lora', serif; color: #c0c0c0; margin: 0.5rem 0; }
    .modal-content p { color: #666; margin: 0.5rem 0; }
    body.dark .modal-content p { color: #b0b0b0; }
    .modal-content button { margin: 0.5rem; }
    .close-modal { background: #1a1a1a; color: #ffffff; }
    body.dark .close-modal { background: #c0c0c0; color: #1a1a1a; }
    .close-modal:hover { background: #c0c0c0; color: #1a1a1a; transform: scale(1.05); }
    body.dark .close-modal:hover { background: #a0a0a0; }
    .spinner { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); border: 4px solid #f3f3f3; border-top: 4px solid #c0c0c0; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; z-index: 200; }
    body.dark .spinner { border-color: #444; border-top-color: #c0c0c0; }
    @keyframes spin { 0% { transform: translate(-50%, -50%) rotate(0deg); } 100% { transform: translate(-50%, -50%) rotate(360deg); } }
    @media (max-width: 600px) {
      header { flex-direction: column; align-items: flex-start; }
      .nav-controls { display: none; }
      .nav-controls.open { display: flex; flex-direction: column; width: 100%; margin-top: 1rem; }
      .hamburger { display: block; position: absolute; top: 1rem; right: 1rem; }
      .cart-icon, .wishlist-icon, .theme-toggle { margin-top: 0.5rem; }
      .product-grid { grid-template-columns: 1fr; }
      .cart-sidebar { width: 100%; }
      .modal-content { max-width: 90%; }
      .controls { flex-direction: column; }
      .carousel-item { flex: 0 0 100%; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Compact Store</h1>
    <div class="nav-controls" id="nav-controls">
      <div class="cart-icon" onclick="toggleCart()" role="button" aria-label="Open cart">
        üõí <span id="cart-count" class="cart-count">0</span>
      </div>
      <div class="wishlist-icon" onclick="toggleWishlist()" role="button" aria-label="Open wishlist">
        ‚ô° <span id="wishlist-count" class="wishlist-count">0</span>
      </div>
      <div class="theme-toggle" onclick="toggleTheme()" role="button" aria-label="Toggle theme">üåô</div>
    </div>
    <div class="hamburger" onclick="toggleMenu()" role="button" aria-label="Toggle menu">‚ò∞</div>
  </header>
  <div class="container">
    <div class="carousel">
      <button class="carousel-nav prev" onclick="carouselPrev()" aria-label="Previous featured product">‚ùÆ</button>
      <div class="carousel-track" id="carousel-track"></div>
      <button class="carousel-nav next" onclick="carouselNext()" aria-label="Next featured product">‚ùØ</button>
    </div>
    <div class="controls">
      <div class="search">
        <input type="text" id="search-input" placeholder="Search products..." aria-label="Search products">
      </div>
      <div class="filter">
        <label for="category-filter">Category</label>
        <select id="category-filter" aria-label="Filter by category">
          <option value="all">All</option>
          <option value="Men">Men</option>
          <option value="Women">Women</option>
          <option value="Accessories">Accessories</option>
        </select>
      </div>
      <div class="filter">
        <label for="price-filter">Max Price: $<span id="price-value">100</span></label>
        <input type="range" id="price-filter" min="0" max="100" value="100" aria-label="Filter by maximum price">
      </div>
      <div class="sort">
        <label for="sort-option">Sort By</label>
        <select id="sort-option" aria-label="Sort products">
          <option value="name-asc">Name (A-Z)</option>
          <option value="price-asc">Price (Low to High)</option>
          <option value="price-desc">Price (High to Low)</option>
        </select>
      </div>
    </div>
    <h2>Products</h2>
    <div class="product-grid" id="product-grid"></div>
  </div>
  <div class="cart-sidebar" id="cart-sidebar">
    <button onclick="toggleCart()" style="color: #c0c0c0;" role="button" aria-label="Close cart">Close</button>
    <h2>Cart</h2>
    <div id="cart-items"></div>
    <p id="cart-total" class="cart-total">Total: $0.00</p>
    <button class="checkout-btn" onclick="checkout()" role="button" aria-label="Checkout">Checkout</button>
  </div>
  <div class="cart-sidebar" id="wishlist-sidebar">
    <button onclick="toggleWishlist()" style="color: #c0c0c0;" role="button" aria-label="Close wishlist">Close</button>
    <h2>Wishlist</h2>
    <div id="wishlist-items"></div>
  </div>
  <div class="modal" id="quick-view-modal">
    <div class="modal-content">
      <img id="modal-image" src="" alt="" loading="lazy">
      <h3 id="modal-name"></h3>
      <p id="modal-price"></p>
      <p id="modal-rating"></p>
      <p>Size: <span id="modal-size">N/A</span></p>
      <p>Color: <span id="modal-color">N/A</span></p>
      <button onclick="addToCartFromModal()" class="product-card button" role="button" aria-label="Add to cart">Add to Cart</button>
      <button onclick="closeModal()" class="close-modal" role="button" aria-label="Close quick view">Close</button>
    </div>
  </div>
  <div class="spinner" id="spinner"></div>
  <script>
    // Mock API fetch simulation
    async function fetchProducts() {
      console.log("Fetching products from:", 'products.json');
      const response = await fetch('products.json');
      console.log("Response status:", response.status);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
      const data = await response.json();
      console.log("Fetched data:", data);
      return data.products;
    }

    let products = [];
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
    let currentProduct = null;
    let carouselIndex = 0;

    async function loadProducts() {
      const spinner = document.getElementById('spinner');
      spinner.style.display = 'block';
      try {
        products = await fetchProducts();
        console.log("Products loaded:", products);
        if (!Array.isArray(products)) {
          console.error("Products is not an array:", products);
          throw new Error("Invalid products data");
        }
        spinner.style.display = 'none';
        renderCarousel();
        filterAndSortProducts();
      } catch (error) {
        console.error("Fetch failed:", error);
        spinner.style.display = 'none';
        document.getElementById('product-grid').innerHTML = '<p>Error loading products. Check console.</p>';
      }
    }

    function renderCarousel() {
      const track = document.getElementById('carousel-track');
      const featuredProducts = products.filter(p => p.featured);
      track.innerHTML = featuredProducts.map(product => `
        <div class="carousel-item">
          <img src="${product.image}" alt="${product.name}" loading="lazy">
          <h3>${product.name}</h3>
          <p>$${product.price.toFixed(2)}</p>
        </div>
      `).join('');
      updateCarousel();
    }

    function updateCarousel() {
      const track = document.getElementById('carousel-track');
      const items = document.querySelectorAll('.carousel-item');
      track.style.transform = `translateX(-${carouselIndex * 33.33}%)`;
      setTimeout(() => {
        carouselIndex = (carouselIndex + 1) % Math.ceil(products.length / 3);
        updateCarousel();
      }, 5000);
    }

    function carouselPrev() {
      carouselIndex = (carouselIndex - 1 + Math.ceil(products.length / 3)) % Math.ceil(products.length / 3);
      updateCarousel();
    }

    function carouselNext() {
      carouselIndex = (carouselIndex + 1) % Math.ceil(products.length / 3);
      updateCarousel();
    }

    function filterAndSortProducts() {
      const maxPrice = document.getElementById('price-filter').value;
      const searchQuery = document.getElementById('search-input').value.toLowerCase();
      const category = document.getElementById('category-filter').value;
      const sortOption = document.getElementById('sort-option').value;
      const spinner = document.getElementById('spinner');
      spinner.style.display = 'block';

      setTimeout(() => {
        let filteredProducts = products.filter(p => 
          p.price <= maxPrice && 
          p.name.toLowerCase().includes(searchQuery) &&
          (category === 'all' || p.category === category)
        );

        if (sortOption === 'price-asc') {
          filteredProducts.sort((a, b) => a.price - b.price);
        } else if (sortOption === 'price-desc') {
          filteredProducts.sort((a, b) => b.price - a.price);
        } else if (sortOption === 'name-asc') {
          filteredProducts.sort((a, b) => a.name.localeCompare(b.name));
        }

        const grid = document.getElementById('product-grid');
        grid.innerHTML = filteredProducts.length === 0 ? '<p>No products found.</p>' : filteredProducts.map(product => `
          <div class="product-card">
            <img src="${product.image}" alt="${product.name}" loading="lazy">
            <h3>${product.name}</h3>
            <p>$${product.price.toFixed(2)}</p>
            <p class="product-desc">${product.description || 'No description'}</p>
            <p>${'‚òÖ'.repeat(product.rating)}${'‚òÜ'.repeat(5 - product.rating)}</p>
            <button onclick="addToCart(${product.id})" aria-label="Add ${product.name} to cart">Add to Cart</button>
            <button onclick="openQuickView(${product.id})" aria-label="Quick view ${product.name}">Quick View</button>
            <button class="wishlist-btn" onclick="toggleWishlistItem(${product.id})" aria-label="${wishlist.some(w => w.id === product.id) ? 'Remove' : 'Add'} ${product.name} to wishlist">${wishlist.some(w => w.id === product.id) ? '‚ô•' : '‚ô°'}</button>
          </div>
        `).join('');
        spinner.style.display = 'none';
      }, 300);
    }

    function filterProducts() {
      document.getElementById('price-value').textContent = document.getElementById('price-filter').value;
      filterAndSortProducts();
    }

    function addToCart(id) {
      const product = products.find(p => p.id === id);
      const cartItem = cart.find(item => item.id === id);
      if (cartItem) {
        cartItem.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      updateCart();
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function addToCartFromModal() {
      if (currentProduct) addToCart(currentProduct.id);
      closeModal();
    }

    function removeFromCart(id) {
      const cartItem = cart.find(item => item.id === id);
      if (cartItem.quantity > 1) {
        cartItem.quantity -= 1;
      } else {
        cart = cart.filter(item => item.id !== id);
      }
      updateCart();
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function toggleWishlistItem(id) {
      const product = products.find(p => p.id === id);
      const inWishlist = wishlist.some(w => w.id === id);
      if (inWishlist) {
        wishlist = wishlist.filter(w => w.id !== id);
      } else {
        wishlist.push({ ...product, quantity: 1 });
      }
      updateWishlist();
      localStorage.setItem('wishlist', JSON.stringify(wishlist));
      filterAndSortProducts();
    }

    function updateCart() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const cartCount = document.getElementById('cart-count');
      cartItems.innerHTML = cart.length === 0 ? '<p>Your cart is empty.</p>' : cart.map(item => `
        <div class="cart-item">
          <span>${item.name} (x${item.quantity})</span>
          <div>
            <span>$${(item.price * item.quantity).toFixed(2)}</span>
            <button onclick="removeFromCart(${item.id})" aria-label="Remove ${item.name} from cart">Remove</button>
          </div>
        </div>
      `).join('');
      const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      cartTotal.textContent = `Total: $${total.toFixed(2)}`;
      cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
    }

    function updateWishlist() {
      const wishlistItems = document.getElementById('wishlist-items');
      const wishlistCount = document.getElementById('wishlist-count');
      wishlistItems.innerHTML = wishlist.length === 0 ? '<p>Your wishlist is empty.</p>' : wishlist.map(item => `
        <div class="cart-item">
          <span>${item.name}</span>
          <div>
            <span>$${item.price.toFixed(2)}</span>
            <button onclick="toggleWishlistItem(${item.id})" aria-label="Remove ${item.name} from wishlist">Remove</button>
          </div>
        </div>
      `).join('');
      wishlistCount.textContent = wishlist.length;
    }

    function toggleCart() {
      document.getElementById('cart-sidebar').classList.toggle('open');
      document.getElementById('wishlist-sidebar').classList.remove('open');
    }

    function toggleWishlist() {
      document.getElementById('wishlist-sidebar').classList.toggle('open');
      document.getElementById('cart-sidebar').classList.remove('open');
    }

    function toggleMenu() {
      document.getElementById('nav-controls').classList.toggle('open');
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      const themeToggle = document.querySelector('.theme-toggle');
      themeToggle.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }

    function openQuickView(id) {
      currentProduct = products.find(p => p.id === id);
      document.getElementById('modal-image').src = currentProduct.image;
      document.getElementById('modal-name').textContent = currentProduct.name;
      document.getElementById('modal-price').textContent = `$${currentProduct.price.toFixed(2)}`;
      document.getElementById('modal-rating').innerHTML = '‚òÖ'.repeat(currentProduct.rating) + '‚òÜ'.repeat(5 - currentProduct.rating);
      document.getElementById('modal-size').textContent = currentProduct.size ? currentProduct.size.join(', ') : 'N/A';
      document.getElementById('modal-color').textContent = currentProduct.color ? currentProduct.color.join(', ') : 'N/A';
      document.getElementById('quick-view-modal').style.display = 'flex';
    }

    function closeModal() {
      document.getElementById('quick-view-modal').style.display = 'none';
      currentProduct = null;
    }

    function checkout() {
      if (cart.length === 0) return alert('Cart is empty!');
      particleEffect();
      alert('Checkout complete! Thanks for shopping, Ade!');
      cart = [];
      updateCart();
      localStorage.setItem('cart', JSON.stringify(cart));
    }

    function particleEffect() {
      const canvas = document.createElement('canvas');
      canvas.style.position = 'fixed';
      canvas.style.top = '0';
      canvas.style.left = '0';
      canvas.style.width = '100%';
      canvas.style.height = '100%';
      canvas.style.pointerEvents = 'none';
      document.body.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      const particles = [];
      for (let i = 0; i < 50; i++) {
        particles.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 3 + 1,
          speedX: Math.random() * 4 - 2,
          speedY: Math.random() * 4 - 2,
          color: '#c0c0c0',
        });
      }
      let frame = 0;
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        particles.forEach(p => {
          p.x += p.speedX;
          p.y += p.speedY;
          p.size *= 0.95;
          ctx.fillStyle = p.color;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
          ctx.fill();
        });
        frame++;
        if (frame < 40) requestAnimationFrame(animate);
        else document.body.removeChild(canvas);
      }
      animate();
    }

    // Initialize theme
    if (localStorage.getItem('theme') === 'dark') {
      document.body.classList.add('dark');
      document.querySelector('.theme-toggle').textContent = '‚òÄÔ∏è';
    }

    // Event listeners
    document.getElementById('search-input').addEventListener('input', filterAndSortProducts);
    document.getElementById('price-filter').addEventListener('input', filterProducts);
    document.getElementById('category-filter').addEventListener('change', filterAndSortProducts);
    document.getElementById('sort-option').addEventListener('change', filterAndSortProducts);

    // Initialize
    updateCart();
    updateWishlist();
    loadProducts();
  </script>
</body>
</html>
